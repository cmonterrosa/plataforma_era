<%= render :partial => "informacion_entornos"%>

<input id="superficie_terreno" name="superficie_terreno" type="hidden"/>


<% form_for :entorno, @entorno, :url => { :action => "save", :id => @entorno, :diagnostico => @diagnostico.id }, :html => {:class => "formee", :id => "entorno"} do |f| -%>
<table class="principal" width="100%" border="0" align="center" cellpadding="2" cellspacing="1" style="BORDER-RIGHT: #cccccc 1px solid; BORDER-TOP: #cccccc 1px solid; BORDER-LEFT: #cccccc 1px solid; BORDER-BOTTOM: #cccccc 1px solid;">
  <tr bgcolor="#003366" style="opacity: 0.7;" >
    <td align="center"><h4>EJE 2: ENTORNO SALUDABLE</h4></td>
  </tr>
  <tr align="center">
    <td align="center">
      <table class="subprincipal" width="100%" border="0" cellpadding="4" cellspacing="1" style="BORDER-RIGHT: #cccccc 1px solid; BORDER-TOP: #cccccc 1px solid; BORDER-LEFT: #cccccc 1px solid; BORDER-BOTTOM: #cccccc 1px solid;">
        <tr>
          <td width="49%" align="justify" style="vertical-align:top;" >
            <!-- Línea Pregunta -->
            <div class="grid-12-12">
              <label class="uper">1.- ¿Cuál es la superficie total del terreno de la escuela en metros cuadrados?<em class="formee-req"> *</em></label>
            </div>
            <!-- Línea campo -->
            <div class="grid-12-12">
              <div class="grid-4-12"></div>
              <div class="grid-3-12">
                <%= f.text_field :superficie_terreno_escuela, :onkeyup => "enaTxtField('entorno_superficie_terreno_escuela', 'entorno_superficie_terreno_escuela_av', 'areas_verdes');", :style => "text-align: right;" %>
              </div>
              <label class="uper" style="padding: 10px 0;" >M&sup2;</label>
            </div>
            <div id="areas_verdes" class="grid-12-12" style="display: none;">
              <label class="uper">1.2.- ¿Qué superficie (mts. cuadrados) de la escuela se destina para áreas verdes? (Espacio cubierto por vegetación que brindan beneficios tanto al ambiente en el que se encuentran como a las personas localizadas cerca de ellos). <em class="formee-req"> *</em></label>
              <div class="grid-12-12">
                <div class="grid-4-12"></div>
                <div class="grid-3-12">
                  <%= f.text_field :superficie_terreno_escuela_av, :onkeyup => "enaTxtField('entorno_superficie_terreno_escuela', 'entorno_superficie_terreno_escuela_av', 'areas_verdes');", :style => "text-align: right;", :disabled => "disabled" %>
                </div>
                <label class="uper" style="padding: 10px 0;" >M&sup2;</label>
              </div>
              <div class="grid-12-12"></div>
              <div id="eje2_p1" class="grid-12-12" style="text-align: center;" >
                <%= link_to image_tag("era/btns_cert/upload.png", :mouseover => "era/btns_cert/upload1.png", :border => 0, :name => "pregunta1", :id => "pregunta1"),
                                                                { :controller => "upload", :diagnostico => @diagnostico, :eje => 2, :numero_pregunta => 1, :action => "list_evidencias" },
                                                                  :title => "EVIDENCIA DE LA PREGUNTA 1", :class => "fancybox fancybox.iframe"%>
              </div>
            </div>
          </td>
          <td>&nbsp;</td>
          <td width="49%" align="justify" style="vertical-align:top;" >
            <!-- Línea pregunta -->
            <div class="grid-12-12">
              <label class="uper">2.- ¿Cuenta la escuela con algunos de los siguientes espacios?<em class="formee-req"> *</em></label>
            </div>
            <fieldset style="padding: 5px 5px 5px 5px;">
              <div id="espacios" class="grid-12-12">
                <% Espacio.find(:all).each do |c| %>
                  <% @valor = nil %>
                  <%  @entorno.escuelas_espacios.each do |x| %>
                    <% @valor = x.numero if x[:espacio_id] == c.id %>
                  <% end %>
                  <%= check_box_tag "espacios[#{c.id}]", c.clave, @s_espacios.include?(c.id) ? true : false, :onclick => "checkBoxTotextField(this, 'eje2_p2', 'entorno_no_espacios');" %>&nbsp;<%= c.descripcion %>&nbsp;CANTIDAD&nbsp;EN&nbsp;M&sup2;&nbsp;<input name="<%= c.clave %>" id="<%= c.clave %>" size="4px" type="others" style="text-align:center; display: none;" value="<%=h @valor ? @valor : "" %>" disabled /><br /><br />
                  <%=linea_horizontal%>
                <% end %>
              </div>
              <%noespacios = (@recupera_entorno && @entorno.escuelas_espacios.empty?)? true : false%>
              <%= f.check_box :no_espacios, { :checked => noespacios,  :onclick => "edMultiSelect('entorno_no_espacios', 'espacios', 'eje2_p2');" }, "NO", "SI" %>&nbsp;NO CUENTA CON ESPACIOS
            </fieldset>
            <div id="eje2_p2" class="grid-12-12" style="display: none; text-align: center;">
                <%= link_to image_tag("era/btns_cert/upload.png", :mouseover => "era/btns_cert/upload1.png", :border => 0, :name => "pregunta2", :id => "pregunta2"),
                                                              {:controller => "upload", :diagnostico => @diagnostico, :eje => 2, :numero_pregunta => 2, :action => "list_evidencias" },
                                                              :title => "EVIDENCIA DE LA PREGUNTA 2", :class => "fancybox fancybox.iframe"%>
            </div>
          </td>
        </tr>
        <tr>
          <td colspan="3" >&nbsp;</td>
        </tr>
        <tr>
          <td align="justify" style="vertical-align:top;">
            <!-- Línea Pregunta -->
            <div class="grid-12-12">
              <label class="uper">3.- ¿La escuela realiza o ha realizado acciones de reforestación dentro o fuera del plantel?<em class="formee-req"> *</em></label>
            </div>
            <!-- Línea campo -->
            <div class="grid-12-12">
              <div class="grid-3-12"></div>
              <div class="grid-5-12">
                <span id="escuela_reforesta" class="InputGroup">
                  <label class="uper">SI <%= f.radio_button :escuela_reforesta, "SI", :onclick => "radioButtonTotxtField(this, 'entorno_escuela_reforesta_num', 'reforesta');" %></label>&nbsp;&nbsp;
                  <label class="uper">NO <%= f.radio_button :escuela_reforesta, "NO", :onclick => "radioButtonTotxtField(this, 'entorno_escuela_reforesta_num', 'reforesta');" %></label>
                </span>
              </div>
              <div class="grid-4-12"></div>
              <div id="reforesta" style="display:none;">
                <div class="grid-6-12">CANTIDAD DE ARBOLES SEMBRADOS:</div>
                <div class="grid-2-12">
                  <%= f.text_field :escuela_reforesta_num, :style => "text-align: center;", :disabled => "disabled" %>
                </div>
                <div class="grid-4-12"></div>
                <div id="eje3_p3" class="grid-12-12" style="text-align: center;">
                  <%= link_to image_tag("era/btns_cert/upload.png", :mouseover => "era/btns_cert/upload1.png", :border => 0, :name => "pregunta3", :id => "pregunta3"),
                                                              {:controller => "upload", :diagnostico => @diagnostico, :eje => 2, :numero_pregunta => 3, :action => "list_evidencias" },
                                                              :title => "EVIDENCIA DE LA PREGUNTA 3", :class => "fancybox fancybox.iframe"%>
                </div>
              </div>
            </div>
          </td>
          <td>&nbsp;</td>
          <td align="left" style="vertical-align:top;">
            <!-- Línea Pregunta -->
            <div class="grid-12-12">
              <label class="uper">4.- ¿La escuela cuenta con árboles nativos y propios de la región? (Consultar listado de arboles nativos de más comunes de clic <a href="/arboles_nativos_no_nativos.pdf" target="_blank" style="color: black;">Aquí</a>.)<em class="formee-req"> *</em></label>
            </div>
            <!-- Línea campo -->
            <div class="grid-12-12">
              <div id="arboles_nativos" style="">
                <div class="grid-2-12">CANTIDAD:&nbsp;<%= f.text_field :arboles_nativos_num, :style => "text-align: center;" %></div>
                <div class="grid-1-12"></div>
                <div class="grid-9-12">NOMBRE&nbsp;COMÚN:&nbsp;<%= f.text_area :arboles_nativos_desc, :style => "text-align: justify;" %></div>
              </div>
              <div class="grid-12-12">
                <%= f.check_box :arboles_nativos, { :onclick => "ena_txtField(this, 'arboles_nativos');" }, "NO", "SI" %>&nbsp;NO CUENTA CON ÁRBOLES NATIVOS
              </div>
              <div class="grid-12-12"><br /></div>
              <div class="grid-12-12">
                <label class="uper">4.1.- ¿Árboles no nativos e impropios de la región existentes en la escuela? (Consultar listado de arboles nativos de más comunes de clic <a href="/arboles_nativos_no_nativos.pdf" target="_blank" style="color: black;">Aquí</a>.)<em class="formee-req"> *</em></label>
              </div>
                <div id="arboles_no_nativos" style="">
                  <div class="grid-2-12">CANTIDAD:&nbsp;<%= f.text_field :arboles_no_nativos_num, :style => "text-align: center;" %></div>
                  <div class="grid-1-12"></div>
                  <div class="grid-9-12">NOMBRE&nbsp;COMÚN:&nbsp;<%= f.text_area :arboles_no_nativos_desc, :style => "text-align: justify;" %></div>
                </div>
                <div class="grid-12-12">
                  <%= f.check_box :arboles_no_nativos, { :onclick => "ena_txtField(this, 'arboles_no_nativos');" }, "NO", "SI" %>&nbsp;NO CUENTA CON ÁRBOLES NO NATIVOS E IMPROPIOS
                </div>
            </div>
          </td>
        </tr>
        <tr>
          <td width="49%" align="justify" style="vertical-align:top;">
            <!-- Liíne pregunta -->
            <div class="grid-12-12">
              <label class="uper">5.- ¿Cuáles de las siguientes acciones del Manual de Salud realiza la institución educativa?<em class="formee-req"> *</em></label>
            </div>
            <div class="grid-12-12">
              <label class="formee-msg-info" style="text-transform:uppercase;font-size:1.1em;" >
                Consultar manual de salud: Manual para el maestro del programa Escuela y Salud. Enfoque actual del programa: Determinantes de la salud, página 42 - 45. Puede consultarlo dando clic <a class="notchange" href="/Manual_de_Salud.pdf" target="_blank"><b>aquí</b></a>
              </label>
            </div>
            <!-- Línea campo -->
            <fieldset style="padding: 5px 5px 5px 5px;">
              <legend style="text-transform:uppercase;font-size:1.1em;">&nbsp;Acciones:&nbsp;</legend>
                <div id="acciones" class="grid-12-12">
                  <% i= 1 %>
                  <% @acciones.each do |c| %>
                    <%= check_box_tag "acciones[#{i}]", c.clave, @s_acciones.include?(c.id) ? true : false, :onclick => "verifyCheckboxs(this, 'acciones', 'eje2_p5');" %>&nbsp;<%= c.descripcion %><br /><br />
                    <% i+=1 %>
                    <%=linea_horizontal%>
                  <% end %>
                </div>
            </fieldset>
            <div class="grid-4-12"></div>
            <div id="eje2_p5" class="grid-8-12" style="display: none;">
              <%= link_to image_tag("era/btns_cert/upload.png", :mouseover => "era/btns_cert/upload1.png", :border => 0, :name => "pregunta5", :id => "pregunta5"),
                                                              {:controller => "upload", :diagnostico => @diagnostico, :eje => 2, :numero_pregunta => 5, :action => "list_evidencias" },
                                                              :title => "EVIDENCIA DE LA PREGUNTA 5", :class => "fancybox fancybox.iframe"%>
            </div>
          </td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
        </tr>
      </table>
    </td>
  </tr>            
  <tr>
    <td colspan="3">&nbsp;</td>
  </tr>
  <%= render :partial => "diagnosticos/errores_evidencias"%>
  <tr>
    <td align="right">
      <table>
        <tr>
          <td>
            <input id="button4" onclick="to_uppercase();" class="buttonText" type="submit" title="Guardar y Regresar" value="Guardar y Regresar" />
          </td>
          <td>
            <a href="<%= diagnosticos_path%>" id="buttonc" class="buttonText"><img src="/images/formee/form-ic-error.png"/>&nbsp;&nbsp;Regresar sin Guardar</a>
          </td>
        </tr>
        <tr>
          <td colspan="2" >&nbsp;</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<% end %>

<script type="text/javascript">
  enaTxtField('entorno_superficie_terreno_escuela', 'entorno_superficie_terreno_escuela_av', 'areas_verdes');
  checkBoxTotextField('espacios', 'eje2_p2', 'entorno_no_espacios');
  edMultiSelect('entorno_no_espacios', 'espacios', 'eje2_p2');
  radioButtonTotxtField('entorno_escuela_reforesta_si', 'entorno_escuela_reforesta_num', 'reforesta');
  radioButtonTotxtField('entorno_escuela_reforesta_no', 'entorno_escuela_reforesta_num', 'reforesta');
  ena_txtField('entorno_arboles_nativos', 'arboles_nativos');
  ena_txtField('entorno_arboles_no_nativos', 'arboles_no_nativos');
  verifyCheckboxs('', 'acciones', 'eje2_p5');
  
  var superficie_terreno_escuela = new LiveValidation( 'entorno_superficie_terreno_escuela' );
  superficie_terreno_escuela.add( Validate.Presence );
  superficie_terreno_escuela.add( Validate.Numericality, { minimum: parseInt(document.getElementById('entorno_superficie_terreno_escuela_av').value) } );

  var superficie_terreno_escuela_av = new LiveValidation( 'entorno_superficie_terreno_escuela_av' );
  superficie_terreno_escuela_av.add( Validate.Presence );
  superficie_terreno_escuela_av.add( Validate.Numericality, { maximum: parseInt(document.getElementById('entorno_superficie_terreno_escuela').value) } );
  

  var arboles_nativos_num = new LiveValidation( 'entorno_arboles_nativos_num' );
  arboles_nativos_num.add( Validate.Presence );
  arboles_nativos_num.add( Validate.Numericality );

  var arboles_nativos_desc = new LiveValidation( 'entorno_arboles_nativos_desc' );
  arboles_nativos_desc.add( Validate.Presence );

  var arboles_no_nativos_num = new LiveValidation( 'entorno_arboles_no_nativos_num' );
  arboles_no_nativos_num.add( Validate.Presence );
  arboles_no_nativos_num.add( Validate.Numericality );

  var arboles_no_nativos_desc = new LiveValidation( 'entorno_arboles_no_nativos_desc' );
  arboles_no_nativos_desc.add( Validate.Presence );

  jQuery(function(){
    jQuery("#espacios").validate({ expression: "if (skipSelectEspacios(SelfID, 'entorno_no_espacios')) return true; else return false;", message: "Seleccione una opción!" });
    jQuery("#escuela_reforesta").validate({ expression: "if (isChecked(SelfID)) return true; else return false;", message: "Seleccione una opción!" });
    jQuery("#acciones").validate({ expression: "if (isCheckedC(SelfID)) return true; else return false;", message: "Seleccione una opción!" });
  });

  jQuery("#entorno_superficie_terreno_escuela").keyup(function() {
      superficie_terreno_escuela_av.remove( Validate.Numericality, { maximum: parseInt(document.getElementById("entorno_superficie_terreno_escuela").value), onlyInteger: true } );
      superficie_terreno_escuela_av.add( Validate.Numericality, { maximum: parseInt(document.getElementById("entorno_superficie_terreno_escuela").value), onlyInteger: true } );
  });

  jQuery("#entorno_superficie_terreno_escuela_av").keyup(function() {
      superficie_terreno_escuela.remove( Validate.Numericality, { minimum: parseInt(document.getElementById("entorno_superficie_terreno_escuela_av").value), onlyInteger: true } );
      superficie_terreno_escuela.add( Validate.Numericality, { minimum: parseInt(document.getElementById("entorno_superficie_terreno_escuela_av").value), onlyInteger: true } );
  });
  
</script>